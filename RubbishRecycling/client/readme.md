# Infotrack CDD

## Deployment info

#### AU
| **AU**| | Notes|
|---|---|---|
| Urls | [Test](https://testsearch.infotrack.com.au/service/cdd) | https://testsearch.infotrack.com.au/service/cdd|
| | [Stage](https://stagesearch.infotrack.com.au/service/cdd) | https://stagesearch.infotrack.com.au/service/cdd|
| | [Prod](https://search.infotrack.com.au/service/cdd) | https://search.infotrack.com.au/service/cdd |
| TeamCity | | http://ci.infotrack.com.au/project.html?projectId=DockerProjects_InfoTrackCdd_Client&tab=projectOverview |
| Octopus | | http://ci.infotrack.com.au:88/app#/Spaces-1/projects/infotrack-cdd-client/overview |
| Rancher | Test | https://rancher.infotrack.com.au/env/1a2243/apps/stacks/1st971|
|  | Stage | https://rancher.infotrack.com.au/env/1a95/apps/stacks/1st972 |
|  | Prod | https://rancher.infotrack.com.au/env/1a5/apps/stacks/1st973 |

#### UK
| **UK**| | Notes|
|---|---|---|
| Urls | [Test](https://testsearch.infotrack.co.uk/service/cdd) | https://testsearch.infotrack.co.uk/service/cdd |
| | [Stage](https://stagesearch.infotrack.co.uk/service/cdd) | https://stagesearch.infotrack.co.uk/service/cdd |
| | [Prod](https://search.infotrack.co.uk/service/cdd) | https://stagesearch.infotrack.co.uk/service/cdd |
| TeamCity | | *Managed by AU* |
| Octopus | | *Managed by AU* |
| Rancher | | https://rancher.infotrack.co.uk/env/1a109887/apps/stacks/1st286 |

#### US
| **US**| | Notes|
|---|---|---|
| APIs | [Test](https://testsearch.infotrack.com/service/cdd) | https://testsearch.infotrack.com/service/cdd |
| | [Stage](https://stagesearch.infotrack.com/service/cdd) | https://stagesearch.infotrack.com/service/cdd/api/swagger/index.html |
| | [Prod](https://search.infotrack.com/service/cdd) | https://search.infotrack.com/service/cdd|
| TeamCity | | *Managed by AU* |
| Octopus | | *Managed by AU* |
| Rancher | | https://rancher.infotrack.com/env/1a34/apps/stacks/1st149 |

### Developing locally

Please install the [Prettier](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) and [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) plugins for VS Code to have a better developer experience. Also you will be better of turning on the _format on save_ feature in VS Code.

To run the project locally:

1. Open the `client` folder in VS Code as the root project.
2. Open a terminal in VS Code and run (make sure **client** is the rot folder)
  `npm i && npm start`
3. Dependencies should be installed and a new tab on `localhost:3000` should open.

** You just need to install dependencies the first time, after that just run `npm start` and start coding üòÄ

## Project structure

### Top-level Project structure

    .    
    ‚îú‚îÄ‚îÄ dist               # git ignored
    ‚îú‚îÄ‚îÄ node_modules       # git ignored
    ‚îú‚îÄ‚îÄ server              
    ‚îî‚îÄ‚îÄ src  


| Folder             | Description    | 
|---------|-----------|
| dist | Folder containing the bundles generated by Webpack (Babel) as part of our building process.           |
| _node_modules_| Dependencies code, must be git ignored|
| server| Code that runs in the docker container that serves our application, it is basically a very simple `express` application that will return our `index.html` as response for all requests|
| src| All the source code related with the user interface and api layer communication |


### `src` folder structure

    .
    ‚îú‚îÄ‚îÄ api           
    ‚îú‚îÄ‚îÄ assets               
    ‚îú‚îÄ‚îÄ components       
    ‚îú‚îÄ‚îÄ config              
    ‚îú‚îÄ‚îÄ constants              
    ‚îú‚îÄ‚îÄ hooks              
    ‚îú‚îÄ‚îÄ pages              
    ‚îú‚îÄ‚îÄ styles              
    ‚îú‚îÄ‚îÄ utils               
    ‚îú‚îÄ‚îÄ index.html              
    ‚îî‚îÄ‚îÄ index.tsx  


| Folder             | Description    | 
|---------|-----------|
| api | Contains all the code responsible for making api calls to the server, including the `api.nswag.ts` file that gets automatically generated when the api layer builds.|
| assets | Any statics assets used in the project e.g images       |
| components | All the independent components that are going to compose each screen, place components that are going to be shared by more than one view here.   |
| constants | Self explanatory, put the constants that are going to be shared across the application here                                                                                                                                                                                             |
| hooks | Custom react hooks that are going to be shared between (functional) components |
| pages | Each page (view) should have its own folder inside this one. If you need to create specific components that are going to be used only in their pages, do not place them in the component folders, use the parent page folder instead. |
| styles| Global styles and theme definition. **This is not a place to put styles that belongs to components. Only globals please** üôè |
| utils | Helper functions/modules used across the project |

### Exporting your modules

Each folder has an `index.tsx` (in case of components) or an `index.ts` (for container folders e.g `src/api`) file that exports all its modules.

```javascript
// src/components/index.ts 
export * from './globalStyles';
export * from './header';
export * from './textInputWrapper';
export * from './contentWrapper';
export * from './divider';
export * from './genericTopBar';
// other exports
```

By using this approach to export our components we can simplify our imports making the code cleaner by avoiding imports repetitions:

What before was:

```javascript
import { TextInputWrapper } from '../../components/textInputWrapper/textInputWrapper';
import { ContentWrapper } from '../../components/contentWrapper/contentWrapper';
import { Divider } from '../../components/divider/divider';
import { GenericTopBar } from '../../components/genericTopBar/genericTopBar';
```

Now is:

```javascript
import {
  TextInputWrapper,
  ContentWrapper,
  Divider,
  GenericTopBar,
} from '../../components';
```

## Writing CSS

We use `theme-ui` to write css allowing us to make the integration with `zenith-ui` easier.

In order make the edition of css/components easier, we decided to keep the styles in the same file when they use only one (or a couple small ones üòâ) `SxStyleProp` object.

```javascript
/** @jsx jsx */
import { jsx, SxStyleProp } from 'theme-ui';
import { ReactNode } from 'react';

interface ContextFooterProps {
  children: ReactNode;
}

const footerCss: SxStyleProp = {
  backgroundColor: 'white',
  padding: '1.5rem',
  bottom: '0px',
  right: '0px',
  boxShadow: '0px -2.5px 3px rgba(150, 150, 150, 0.25)'
};

export const ContextFooter = (props: ContextFooterProps) => {
  const { children } = props;
  return <div sx={footerCss}>{children}</div>;
};

```

When the css gets bigger/complex and starts making the component module code bigger, we just abstract it out to a `[ComponentName]Css.ts` file and import `*` as a `css` object.

```javascript
//ClientDetailsCss.ts
import { SxStyleProp } from 'theme-ui';

export const card: SxStyleProp = {
  backgroundColor: 'white',
  width: ['100%', '100%', '720px'],
  display: 'block',
  marginLeft: 'auto',
  marginRight: 'auto'
};

export const heading: SxStyleProp = {
  fontFamily: 'Inter',
  width: ['100%', '100%', '720px'],
  display: 'block',
  marginLeft: 'auto',
  // example of how to reference theme variables defined by zenith
  color: 'success'
};

//.. rest of the css objects
```

```javascript
//ClientDetails.tsx
import * as css from './clientDetailsCss';

// ... other imports

export function ClientDetails() {
  return (
    <WorkflowContainer>
      <Sidebar>Hey I am the sidebar for client details üòÅ</Sidebar>
      <WorkflowContent>
        <Card sx={css.card}>
          <h2 sx={css.heading}>Enter client details</h2>
          //... rest of the component
```

## Recommendations

* Keep your components small(ish), a good metric is the amount of other components/tags that are part of it. If it goes too big (more than hundred lines or so) consider splitting it into smaller components to make the code more readable. Just think how it would be easier to maintain and use common sense and you should be fine üëç.

* Before writing your own styles/colors, please explore what options are already available in [Zenith](https://zenith.infotrack.com.au/latest/index.html?path=/story/components-theme--colors), also, before start developing a new component, please check with the UI/UX gang to avoid start building something they are already working on.

* **Do not try to abstract too soon**. Before making a _generic_ component, make sure you actually need it, start with simple components (it is ok to repeat yourself until you understand what is the common logic/component that need to be abstracted), and you will realize when is time to encapsulate something that is being used in several places into a new component. If you are passing to many parameters, or the logic to support different use cases gets complex in your _generic_ component, you should reconsider that abstraction and maybe split it into different (and simpler) components for each sue case. Do not be afraid of **refactoring your components often**.
